"use strict";function mixinData(a){var b=new Firebase("https://mixinaid.firebaseio.com/mixins"),c=a(b);return{mixinsArray:c}}angular.module("mixinaidApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","firebase.ref","firebase.auth"]),angular.module("mixinaidApp").controller("MainCtrl",["$scope","$sce","$firebaseArray","user",function(a,b,c,d){function e(b){if(""!==b.comment.text){var c={text:b.comment.text,user:a.username},d=a.mixinsArray.$getRecord(b.$id);d.comments.push(c),d.comment.text="",a.mixinsArray.$save(d).then(function(){console.log("saved")})}}function f(a){return b.trustAsHtml(a)}function g(b){var c=a.mixinsArray.$getRecord(b.$id);c.saved=!c.saved,a.mixinsArray.$save(c).then(function(){console.log("saved")})}a.submitComment=e,a.trust=f,a.filter="",a.save=g;var h=new Firebase("https://mixinaid.firebaseio.com/mixins");a.mixinsArray=c(h),d&&(a.email=d.password.email,a.username=a.email.substring(0,a.email.indexOf("@")))}]),angular.module("firebase.config",[]).constant("FBURL","https://mixinaid.firebaseio.com").constant("SIMPLE_LOGIN_PROVIDERS",["password","google","github"]).constant("loginRedirectPath","/login"),angular.module("firebase.ref",["firebase","firebase.config"]).factory("Ref",["$window","FBURL",function(a,b){return new a.Firebase(b)}]),angular.module("mixinaidApp").controller("ChatCtrl",["$scope","Ref","$firebaseArray","$timeout",function(a,b,c,d){function e(b){a.err=b,d(function(){a.err=null},5e3)}a.messages=c(b.child("messages").limitToLast(10)),a.messages.$loaded()["catch"](e),a.addMessage=function(b){b&&a.messages.$add({text:b})["catch"](e)}}]),angular.module("mixinaidApp").filter("reverse",function(){return function(a){return angular.isArray(a)?a.slice().reverse():[]}}),function(){angular.module("firebase.auth",["firebase","firebase.ref"]).factory("Auth",["$firebaseAuth","Ref",function(a,b){return a(b)}])}(),angular.module("mixinaidApp").controller("LoginCtrl",["$scope","Auth","$location","$q","Ref","$timeout",function(a,b,c,d,e,f){function g(a){return h(a.substr(0,a.indexOf("@"))||"")}function h(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}function i(){c.path("/")}function j(b){a.err=b}a.oauthLogin=function(c){a.err=null,b.$authWithOAuthPopup(c,{rememberMe:!0}).then(i,j)},a.anonymousLogin=function(){a.err=null,b.$authAnonymously({rememberMe:!0}).then(i,j)},a.passwordLogin=function(c,d){a.err=null,b.$authWithPassword({email:c,password:d},{rememberMe:!0}).then(i,j)},a.createAccount=function(c,h,k){function l(a){var b=e.child("users",a.uid),h=d.defer();return b.set({email:c,name:g(c)},function(a){f(function(){a?h.reject(a):h.resolve(b)})}),h.promise}a.err=null,h?h!==k?a.err="Passwords do not match":b.$createUser({email:c,password:h}).then(function(){return b.$authWithPassword({email:c,password:h},{rememberMe:!0})}).then(l).then(i,j):a.err="Please enter a password"}}]),angular.module("mixinaidApp").controller("AccountCtrl",["$scope","$rootScope","user","Auth","Ref","$firebaseObject","$timeout",function(a,b,c,d,e,f,g){function h(a){j(a,"danger")}function i(a){j(a,"success")}function j(b,c){var d={text:b+"",type:c};a.messages.unshift(d),g(function(){a.messages.splice(a.messages.indexOf(d),1)},1e4)}a.user=c,b.user=c,a.logout=function(){d.$unauth()},a.messages=[];var k=f(e.child("users/"+c.uid));k.$bindTo(a,"profile"),a.changePassword=function(b,c,e){a.err=null,b&&c?c!==e?h("Passwords do not match"):d.$changePassword({email:k.email,oldPassword:b,newPassword:c}).then(function(){i("Password changed")},h):h("Please enter all fields")},a.changeEmail=function(b,c){a.err=null,d.$changeEmail({password:b,newEmail:c,oldEmail:k.email}).then(function(){k.email=c,k.$save(),i("Email changed")})["catch"](h)}}]),angular.module("mixinaidApp").directive("ngShowAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("mixinaidApp").directive("ngHideAuth",["Auth","$timeout",function(a,b){return{restrict:"A",link:function(c,d){function e(){b(function(){d.toggleClass("ng-cloak",!!a.$getAuth())},0)}d.addClass("ng-cloak"),a.$onAuth(e),e()}}}]),angular.module("mixinaidApp").config(["$routeProvider","SECURED_ROUTES",function(a,b){a.whenAuthenticated=function(c,d){return d.resolve=d.resolve||{},d.resolve.user=["Auth",function(a){return a.$requireAuth()}],a.when(c,d),b[c]=!0,a}}]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{user:["Auth",function(a){return a.$getAuth()}]}}).when("/chat",{templateUrl:"views/chat.html",controller:"ChatCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).whenAuthenticated("/account",{templateUrl:"views/account.html",controller:"AccountCtrl"}).when("/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/all",{templateUrl:"views/all.html",controller:"AllCtrl"}).when("/new",{templateUrl:"views/new.html",controller:"NewCtrl",resolve:{user:["Auth",function(a){return a.$getAuth()}]}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","Auth","SECURED_ROUTES","loginRedirectPath",function(a,b,c,d,e){function f(a){!a&&g(b.path())&&b.path(e)}function g(a){return d.hasOwnProperty(a)}c.$onAuth(f),a.$on("$routeChangeError",function(a,c,d,f){"AUTH_REQUIRED"===f&&b.path(e)})}]).constant("SECURED_ROUTES",{}),angular.module("mixinaidApp").controller("ProfileCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mixinaidApp").controller("AllCtrl",["$scope","$firebaseArray","$sce",function(a,b,c){function d(b,c){if(""!==b.comment.text){var d={text:b.comment.text,user:c};console.log(a.mixinsArray[b.$id].comments);var e=a.mixinsArray.$getRecord(b.$id);e.comments.push(d),e.comment.text="",a.mixinsArray.$save(e).then(function(){console.log("saved")})}}function e(a){return c.trustAsHtml(a)}function f(b){var c=a.mixinsArray.$getRecord(b.$id);c.saved=!c.saved,a.mixinsArray.$save(c).then(function(){console.log("saved")})}a.submitComment=d,a.trust=e,a.filter="",a.save=f;var g=new Firebase("https://mixinaid.firebaseio.com/mixins");a.mixinsArray=b(g)}]),angular.module("mixinaidApp").controller("NewCtrl",["$scope","$firebaseArray","user","$location",function(a,b,c,d){function e(){!a.mixinSubmitted&&a.newMixin.title?(a.mixinSubmitted=!0,a.mixinsArray.$add(a.newMixin).then(function(){console.log("saved"),d.path("#/all")})):console.log("title required")}a.saveMixin=e;var f=new Firebase("https://mixinaid.firebaseio.com/mixins");a.mixinsArray=b(f),a.email=c.password.email,a.username=a.email.substring(0,a.email.indexOf("@")),a.newMixin={comments:[{user:a.username,text:""}],title:"",saved:!0,copied:!1,codePen:"",submittedBy:a.username,mixin:"",comment:{text:""}}}]),angular.module("mixinaidApp").controller("NavCtrl",function(){var a=this;a.menuOpen=!1}),angular.module("mixinaidApp").factory("mixinData",mixinData),mixinData.$inject=["$firebaseArray"];